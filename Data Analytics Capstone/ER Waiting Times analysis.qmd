---
title: "Emergency Waiting time Analysis"
format: html
editor: visual
---

# Business Understanding

## Who is our Client?

In a recent article by Global News they cited a report by the Montreal Economic Institute (MEI) stating that the median duration of stay in an Alberta emergency room in 2024 was three hours and fifty-eight minutes—fifty-four minutes longer than in 2019 (Cobb, 2025). This indicates that patients have seen no improvements in timely access to care over the past five years. The report also noted that, despite efforts by Government of Alberta to reduce wait times, Chris Gallaway—executive director of the “Friends of Medicare advocacy”—emphasized that a robust staffing plan is necessary to achieve meaningful reductions in wait times and improve overall patient care.

In response, Alberta Health Services (AHS)--the province-wide health authority responsible for operating hospitals, urgent cares, clinics, and health programs across Alberta—hired 5 data analyst consultants to analyze emergency wait time data from different hospitals. Their objective is to identify the factors driving delays and to predict traffic and wait times based on variables such as urgency level, nurse-to-patient ratio, and specialist availability. This analysis will support AHS in optimizing resource allocation to achieve the improvements highlighted by Gallaway.

## Business Questions

-   At what times of day, days of week, or months are wait times the longest?

-   Are wait times longer for different urgency levels? This will help the analyst understand if increasing the number of specialists available would reduce wait times for patients with higher urgency levels

-   What is the threshold wait time where patients consider it as unsatisfactory?

-   How does staff utilization and facility correlate with wait times? Which resource constraints caused the most bottleneck?

-   Can we identify patients who are at high risk of leaving without being seen?

**Multiple regression Analysis**

-   Which combination of variables best predicts wait times and patient satisfaction?

-   Can we build a regression model that predicts wait times and satisfaction scores under different variable conditions?

**Monte-carlo simulation:**

-   How do different resource allocation strategies affect the distribution of wait times and satisfaction scores?

-   Which interventions consistently reduce wait times across a wide range of simulated scenarios while staying cost-effective?

# Data Understanding

**Data format:** CSV

**Rows and Columns:** 50,000 rows and 20 columns

# Data Cleaning

## Loading necessary libraries:

```{r}
#| warning: false
#| message: false
#| include: true

library(dplyr)
library(hms)
library(lubridate)
library(tidyverse)
library(tidytext)
library(corrplot)
library(olsrr)

```

## Loading the ER Waiting Times data:

```{r}
#| Warning: false
#| message: false
#| include: true


ERdata <- read.csv("https://raw.githubusercontent.com/Archangelo08/Data-Analytics-SAIT-Projects/refs/heads/main/Data%20Analytics%20Capstone/ER%20Wait%20Time%20Dataset.csv")
```

## Data cleaning and transformations

**Checking for nulls and errors:**

```{r}
#| warning: false
#| message: false
#| include: true

ERdata %>% 
  sapply(function(x) sum(is.na(x)| x == ""))

```

There are no nulls or empty rows found in the Emergency Waiting times data.

**Checking the data types for each variable:**

```{r}
#| warning: false
#| message: false
#| include: true

str(ERdata)

```

The \[Visit Date\] column is assigned with "chr" data type. This should be assigned with the appropriate date-time data type. To do this, first, the date and time components will be separated into two new calculated columns: "Date of visit" and "Time of visit". After, we will remove the \[Visit Date\] column since it will not be used in the succeeding analysis.

```{r}
#| warning: false
#| message: false
#| include: true

ERdata <- ERdata %>% 
  mutate(Visit.Date = as.POSIXct(Visit.Date, format = "%Y-%m-%d %H:%M:%S", tz = "UTC")) %>% 
  mutate(
    Date_of_visit = as.Date(Visit.Date),
    Time_of_visit = as_hms(Visit.Date)
  )
```

After further inspection of the data, we found out that the \[Time of Day\] column does not accurately describe the time of day based on the time value in the \[Time of visit\] column, hence it will be removed. A new calculated column will be created in the succeeding section.

```{r}
#| warning: false
#| message: false
#| include: true

ERdata <- ERdata %>% 
  select(-Time.of.Day)
```

**Changing column names for clarity:**

```{r}
#| warning: false
#| message: false
#| include: true

ERdata <- ERdata %>% 
  rename(
    Available.Beds = Facility.Size..Beds.,
    Time.to.Registration.min = Time.to.Registration..min.,
    Time.to.Triage.min = Time.to.Triage..min.,
    Time.to.Medical.Professional.min = Time.to.Medical.Professional..min.,
    Total.Wait.Time.min = Total.Wait.Time..min.
  )
```

As a replacement of the Time of day, we will be creating a new calculated column, Shift, that groups the time each patient visited the Emergency department. Patients will be group by the hour they visited and by the three shifts in a 24-hour period.

```{r}
#| warning: false
#| message: false
#| include: true

ERdata <- ERdata %>% 
  mutate(
    Shift = case_when(
      hour(Time_of_visit) %in% c(7,8,9,10,11,12,13,14) ~ "Day",
      hour(Time_of_visit) %in% c(13,14,15,16,17,18,19,20,21,22) ~ "Evening",
      hour(Time_of_visit) %in% c(23,0,1,2,3,4,5,6) ~ "Night"
    )
  )

```

**Added a new column Updated_time_of_day, categorizes each time into Early Morning, Late Morning, Afternoon, Evening and Night.**

*Although this is a good grouping for Time of Day each patient visited the Emergency Department, I think it would be a better idea to group it based on the 3, 24-hour shift of Nurses and Doctors. This would be a better analysis that would give us insights, such as "we saw a significantly longer wait times during Night Shifts". Some of the possible reasons can be: Low Nurse-to-patient ratio.*

```{r}
#| warning: false
#| message: false
#| include: true

ERdata <- ERdata %>%
  mutate(
    hour = hour(Time_of_visit),

    Updated_time_of_day = case_when(
      hour >= 4  & hour < 8  ~ "Early Morning",
      hour >= 8  & hour < 12 ~ "Late Morning",
      hour >= 12 & hour < 17 ~ "Afternoon",
      hour >= 17 & hour < 20 ~ "Evening",
      TRUE ~ "Night"   # 20–23pm and 0–3 (mdnight - am)
    )
  ) %>%
  select(-hour)   # removes temporary hour column

sum(is.na(ERdata$Updated_time_of_day)) # check for NA values
```

```{r}
#| warning: false
#| message: false
#| include: true



```

Added a new column "Satisfaction_group" that categorizes Patient.Satisfaction scores (1–5) into:

-   Satisfied (4-5)

<!-- -->

-   Neutral (3)

-   Dissatisfied (1-2)

```{r}
#| warning: false
#| message: false
#| include: true
ERdata <- ERdata %>%
  mutate(
    Satisfaction_group = case_when(
      Patient.Satisfaction == 1 ~ "Very Dissatisfied",
      Patient.Satisfaction == 2 ~ "Dissatisfied",
      Patient.Satisfaction == 3 ~ "Neutral",
      Patient.Satisfaction == 4 ~ "Satisfied",
      Patient.Satisfaction == 5 ~ "Very Satisfied"
    )
  )
```

Get min and max values for Total.Wait.Time.min

```{r}
#| warning: false
#| message: false
#| include: true
min(ERdata$Total.Wait.Time.min, na.rm = TRUE)
max(ERdata$Total.Wait.Time.min, na.rm = TRUE)
```

Added a new column Waiting_time_group, assigns each patient's total wait time (in minutes) into one of the 6 categories:

-   Very Short Wait (4–14)

-   Short Wait (15–29)

-   Moderate Wait (30–59)

-   Long Wait (60–119)

-   Very Long Wait (120–239)

-   Excessive Wait (240–442)

    ```{r}
    #| warning: false
    #| message: false
    #| include: true

    ERdata <- ERdata %>%
      mutate(
        Waiting_time_group = case_when(
          Total.Wait.Time.min >= 4   & Total.Wait.Time.min <= 14  ~ "Very Short Wait",
          Total.Wait.Time.min >= 15  & Total.Wait.Time.min <= 29  ~ "Short Wait",
          Total.Wait.Time.min >= 30  & Total.Wait.Time.min <= 59  ~ "Moderate Wait",
          Total.Wait.Time.min >= 60  & Total.Wait.Time.min <= 119 ~ "Long Wait",
          Total.Wait.Time.min >= 120 & Total.Wait.Time.min <= 239 ~ "Very Long Wait",
          Total.Wait.Time.min >= 240 & Total.Wait.Time.min <= 442 ~ "Excessive Wait",
          TRUE ~ NA_character_   # fallback if something is outside expected range
        )
      )
    ```

## Exploratory Data Analysis

In this section, distribution of the different features will be explored and relationships between them will be uncovered.

**Distribution of Hospitals by Region**

```{r}
#| warning: false
#| message: false
#| include: true

ERdata %>% 
  group_by(Region) %>% 
  summarize(No_of_hospitals = n_distinct(Hospital.Name)) %>% 
  ggplot(aes(Region,No_of_hospitals)) +
  geom_col() +
  labs(
    title = "Number of Hospitals by Region",
    x = ""
  ) +
  theme_minimal()
  
```

This data is being represented by 2 hospitals in the Rural region and 3 in the Urban region.

**Number of Patients by Season**

```{r}
#| warning: false
#| message: false
#| include: true

ERdata %>% 
  group_by(Season) %>% 
  summarize(No_of_patients = n()) %>% 
  ggplot(aes(reorder(Season, No_of_patients), No_of_patients)) +
  geom_col() +
  coord_flip() +
  labs(
    title = "Distribution of patients by Season",
    x = "",
    y = "Number of Patients"
  ) +
  theme_minimal()
```

In terms of Season, we see more patients visiting the Emergency department in Summer, followed by Winter, Fall, and Spring.\
\
**Number of Patients by Hospital by Region**

```{r}
#| warning: false
#| message: false
#| include: true


ERdata %>% 
  group_by(Region, Hospital.Name) %>% 
  summarize(No_of_Patients = n()) %>% 
  mutate(Hospital.Name = reorder_within(Hospital.Name, No_of_Patients, Region)) %>%
  ggplot(aes(Hospital.Name,No_of_Patients, fill=Region)) +
    geom_col() +
    scale_x_reordered() +
    labs(
      title = "Distribution of Patients by Region and Hospital",
      x = "",
      y = "Nuber of Patients"
    ) +
    coord_flip() +
    theme_minimal()
  
```

**Number of Patients by Urgency Level**

```{r}
#| warning: false
#| message: false
#| include: true

ERdata %>% 
  group_by(Urgency.Level) %>% 
  summarize(No_of_patients = n()) %>% 
  ggplot(aes(reorder(Urgency.Level, No_of_patients), No_of_patients)) +
  geom_col() +
  coord_flip() +
  labs(
    title = "Distribution of Patients by Urgency Level",
    x = "Urgency Level",
    y = ""
  ) +
  theme_minimal()
```

**Distribution of Patients by Staff Shift**

```{r}
#| warning: false
#| message: false
#| include: true


ERdata %>% 
  group_by(Shift) %>% 
  summarize(No_of_patients = n()) %>% 
  ggplot(aes(Shift, No_of_patients)) +
  geom_col() +
  labs(
    title = "Distribution of Patients by Shift",
    x = "Shift",
    y = ""
  ) +
  theme_minimal()
```

**Distribution of Nurse-to-Patient ratio per visit**

```{r}
#| warning: false
#| message: false
#| include: true

ERdata %>% 
  ggplot(aes(Nurse.to.Patient.Ratio)) +
    geom_bar() +
  labs(
    title = "Distribution of Nurse-to-Patient ratio per Visit",
    x = "Nurse-to-Patient Ratio",
    y = "Count"
  ) +
  theme_minimal()

```

**Distribution of Specialist available per visit**

```{r}
#| warning: false
#| message: false
#| include: true

ERdata %>% 
  ggplot(aes(factor(Specialist.Availability))) +
    geom_bar() +
    labs(
      title = "Distribution of Specialist Available every patient Visit",
      x = "Specialist Available",
      y = "Count"
    ) +
    theme_minimal()

```

**Distribution of Available beds per visit**

```{r}
#| warning: false
#| message: false
#| include: true

ERdata %>% 
  ggplot(aes("",Available.Beds)) +
    geom_violin(fill="skyblue", alpha=0.6) +
    geom_boxplot(width=0.05, fill="orange", color="black") +
    labs(
      title = "Violin plot for the number of beds available per patient visit",
      x = "",
      y = "Available Beds"
    ) +
    theme_minimal()
  
```

**Time to Registration**

```{r}
#| warning: false
#| message: false
#| include: true

ERdata %>% 
  ggplot(aes("",Time.to.Registration.min)) +
    geom_violin(fill="skyblue", alpha=0.6) +
    geom_boxplot(width=0.05, fill="orange", color="black", outlier.size=2.5, outlier.color="red") +
    labs(
      title = "Violin plot for Time to Registration(minutes)",
      x = "",
      y = "Time to Registration (min)"
    ) +
    theme_minimal()

```

**Time to Triage**

```{r}
#| warning: false
#| message: false
#| include: true

ERdata %>% 
  ggplot(aes("",Time.to.Triage.min)) +
    geom_violin(fill="skyblue", alpha=0.6) +
    geom_boxplot(width=0.05, fill="orange", color="black", outlier.size=2.5, outlier.color="red") +
    labs(
      title = "Violin plot for Time to Triage (minutes)",
      x = "",
      y = "Time to Triage (min)"
    ) +
    theme_minimal()
```

**Time to Medical Professional**

```{r}
#| warning: false
#| message: false
#| include: true

ERdata %>% 
  ggplot(aes("",Time.to.Medical.Professional.min)) +
    geom_violin(fill="skyblue", alpha=0.6) +
    geom_boxplot(width=0.05, fill="orange", color="black", outlier.size=2.5, outlier.color="red") +
    labs(
      title = "Violin plot for the Time it takes to see a Medical Professional",
      x = "",
      y = "Time to see Medical Professional(min)"
    ) +
    theme_minimal()
```

**Total Wait time**

```{r}
#| warning: false
#| message: false
#| include: true

ERdata %>% 
  ggplot(aes("",Total.Wait.Time.min/60)) +
    geom_violin(fill="skyblue", alpha=0.6) +
    geom_boxplot(width=0.05, fill="orange", color="black", outlier.size=2.5, outlier.color="red") +
    labs(
      title = "Violin plot for the Total Wait Time (hour)",
      x = "",
      y = "Total Wait Time (hr)"
    ) +
    theme_minimal()
```

**Patient Outcome distribution**

```{r}
#| warning: false
#| message: false
#| include: true

ERdata %>% 
  ggplot(aes(Patient.Outcome)) +
    geom_bar() +
    labs(
      title = "Distribution of Patient Outcome",
      x = "Outcomes",
      y = "Count"
    ) +
    theme_minimal()
```

**Patient Satisfaction distribution**

```{r}
#| warning: false
#| message: false
#| include: true

ERdata %>% 
  ggplot(aes(factor(Patient.Satisfaction))) +
    geom_bar() +
    labs(
      title = "Distribution of Patient Satisfaction",
      x = "Satisfaction Score",
      y = "Count"
    ) +
    theme_minimal()

```

# Modeling

This section is where the best predictor variables are going to be identified to form the best multiple regression equation that will predict total wait time and patient satisfaction.

These are the predictor variables for Total wait time:

-   Region (factor)

-   Day of Week (factor)

-   Season (factor)

-   Urgency level (factor)

-   Nurse-to-Patient ratio

-   Specialist Availability

-   Available beds

-   Shift (factor)

These are the predictor variables for Patient Satisfaction:

-   Urgency Level (factor)

-   Nurse-to-Patient ratio

-   Specialist Availability

-   Available beds

-   Shift (factor)

-   Time to Registration

-   Time to Triage

-   Time to Medical Professional min

-   Patient Outcome

## **Fitting the maximum regression model for Wait Time and Patient Satisfaction:**

```{r}
#| warning: false
#| message: false
#| include: true

# Wait Time
WaitTime_var <- ERdata %>% 
  mutate(
    Region = factor(Region),
    Day.of.Week = factor(Day.of.Week),
    Season = factor(Season),
    Urgency.Level = factor(Urgency.Level),
    Shift = factor(Shift)
  ) %>% 
  select(
    Region,
    Day.of.Week,
    Season,
    Urgency.Level,
    Nurse.to.Patient.Ratio,
    Specialist.Availability,
    Available.Beds,
    Shift,
    Total.Wait.Time.min
  )
  
WaitTime_maxmodel <- WaitTime_var %>% 
  lm(
    Total.Wait.Time.min ~
      Region +
      Day.of.Week +
      Season +
      Urgency.Level +
      Nurse.to.Patient.Ratio +
      Specialist.Availability +
      Available.Beds +
      Shift, 
    .
  )

# Patient Satisfaction
PatientSat_var <- ERdata %>% 
  mutate(
    Urgency.Level = factor(Urgency.Level),
    Shift = factor(Shift),
    Patient.Outcome = factor(Patient.Outcome),
  ) %>% 
  select(
    Urgency.Level,
    Nurse.to.Patient.Ratio,
    Specialist.Availability,
    Available.Beds,
    Shift,
    Time.to.Registration.min,
    Time.to.Triage.min,
    Time.to.Medical.Professional.min,
    Patient.Outcome,
    Patient.Satisfaction
  )

PatientSat_maxmodel <- PatientSat_var %>% 
  lm(
    Patient.Satisfaction ~
      Urgency.Level +
      Nurse.to.Patient.Ratio +
      Specialist.Availability +
      Available.Beds +
      Time.to.Registration.min +
      Time.to.Triage.min +
      Time.to.Medical.Professional.min +
      Shift +
      Patient.Outcome,
    .
  )
```

## Finding the best regression model for Wait Time and Patient Satisfaction

Applying stepwise (both-direction) to find the best regression model to predict Wait Time and Patient Satisfaction

```{r}
#| warning: false
#| message: false
#| include: true

WaitTime_step <- ols_step_both_aic(WaitTime_maxmodel)
PatientSat_step <- ols_step_both_aic(PatientSat_maxmodel)

WaitTime_best <- WaitTime_step$model
PatientSat_best <- PatientSat_step$model

```

Looking at the summary information for the best models generated by Stepwise to predict Wait Time and Patient Satisfaction.

```{r}
#| warning: false
#| message: false
#| include: true

summary(WaitTime_best)
summary(PatientSat_best)

```
